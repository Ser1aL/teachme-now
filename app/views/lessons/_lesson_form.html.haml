- lesson ||= Lesson.new
- course ||= lesson.course
- errors = lesson.errors.messages
- selected_interest = lesson.try(:interest) || interests.first
- course_id = params[:course_id] || lesson.course_id
= tinymce theme: 'simple'
.pretty_form
  = form_for lesson do |f|
    = f.hidden_field :course_id, value: course_id
    .line
      .full_line_input
        .hint
          = t "lesson_form.name"
          - if errors[:name]
            %span.error= "(#{errors[:name].first})"
        .text_input
          = f.text_field :name
      .delimiter
    .line
      .half_line_input.left
        .hint
          = t "lesson_form.city"
          - if errors[:city]
            %span.error= "(#{errors[:city].first})"
        .select_input
          = f.select :city, APP_CONFIG["supported_cities"].map{ |city| [t("lesson_form.#{city.downcase}"), city] }
      .half_line_input.right
        .hint
          = t "lesson_form.level"
          - if errors[:level]
            %span.error= "(#{errors[:level].first})"
        .select_input
          = f.select :level, skill_level_options(lesson.try(:level))
      .delimiter
    .line
      .half_line_input.left
        .hint
          = t "lesson_form.capacity"
          - if errors[:capacity]
            %span.error= "(#{errors[:capacity].first})"
        .select_input
          = f.select :capacity, 1..40, selected: lesson.try(:capacity) || 10
      .half_line_input.right
        .hint
          = t "lesson_form.place_price"
        .select_input
          = f.select :place_price, (20..800).step(20), selected: lesson.try(:place_price) || 120
      .delimiter
    .line
      .full_line_input
        .hint
          = t "lesson_form.address_line"
          - if errors[:address_line]
            %span.error= "(#{errors[:address_line].first})"
        .text_input
          = f.text_field :address_line
      .delimiter
    .delim
    .line
      .full_line_input
        .hint
          = t "lesson_form.start_date_time"
          - if errors[:start_datetime]
            %span.error= "(#{errors[:start_datetime].first})"
        .text_input#date_time_input
          = f.text_field :start_datetime
        .delimiter
    .line
      .dynamic_line_input
        .hint
          = t "lesson_form.duration"
          - if errors[:duration]
            %span.error= "(#{errors[:duration].first})"
        .hours.dynamic_input.select_input
          = f.select :hours, hours_options(lesson.try(:duration))
        .minutes.dynamic_input.select_input
          = f.select :minutes, minutes_options(lesson.try(:duration))
        - unless course
          .interest.dynamic_input.select_input
            = f.select :interest_id, interests.map{ |i| [t("interests.#{i.name}").capitalize, i.id] }
          .sub_interest.dynamic_input.select_input
            = f.select :sub_interest_id, selected_interest.sub_interests.map{ |i| [t("sub_interests.#{i.name}").capitalize, i.id] }
      .delimiter
    .delim
    .line
      .full_line_input
        .hint
          = t "lesson_form.description"
          - if errors[:description]
            %span.error= "(#{errors[:description].first})"
        .textarea_input
          = f.text_area :description, class: 'tinymce'
      .delimiter
    .delim
    - if course && course.try(:tease_description).present?
      = f.hidden_field :tease_description, value: course.tease_description
    - else
      .line
        .full_line_input
          .hint
            = t "lesson_form.tease_description"
            - if errors[:tease_description]
              %span.error= "(#{errors[:tease_description].first})"
          .textarea_input
            = f.text_area :tease_description, class: 'tinymce'
        .delimiter
    .line
      .create_lesson.submittable
        %a
          - if lesson.new_record?
            %span= t("lesson_form.create_lesson")
          - else
            %span= t("lesson_form.edit_lesson")
      .delimiter
